---
title: "Target 2"
output: pdf_document
---

First, We load all required packages and define a color palette for continents.

```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)
library(ggthemes)

continent_colors <- c(
  "Asia"          = "#377EB8",
  "Europe"        = "#4DAF4A",
  "Africa"        = "#984EA3",
  "North America" = "#E41A1C",
  "South America" = "#FF7F00",
  "Oceania"       = "#A65628"
)
```

------------------------------------------------------------------------

Load datasets:

We import the NEET dataset, the continent mapping, youth unemployment, and population.

```{r load-data}
neet_raw <- read_csv("youth-not-in-education-employment-training.csv")
continents_raw <- read_csv("continents-according-to-our-world-in-data.csv")
youth_unemp_raw <- read_csv("youth_unemployment.csv", skip = 3)
population_raw <- read_csv("population.csv")
```

------------------------------------------------------------------------

3.  Clean NEET data (limit to 2020)

```{r clean-neet}
neet <- neet_raw %>%
  select(
    Entity,
    Code,
    Year,
    neet_share = `Share of youth not in education, employment or training, total (% of youth population)`
  ) %>%
  mutate(
    Year       = as.integer(Year),
    neet_share = as.numeric(neet_share)
  ) %>%
  filter(
    !is.na(Code),
    !is.na(neet_share),
    Year >= 1990,
    Year <= 2020
  )
```

------------------------------------------------------------------------

Clean continent dataset

```{r clean-continents}
continents <- continents_raw %>%
  select(Entity, Code, Continent) %>%
  distinct(Code, .keep_all = TRUE) %>%
  filter(Continent != "Antarctica")
```

------------------------------------------------------------------------

Attach continent to NEET

```{r merge-neet-continent}
neet_continent <- neet %>%
  inner_join(continents, by = c("Code", "Entity"))
```

------------------------------------------------------------------------

Clean youth unemployment (WDI)

```{r clean-unemployment}
year_cols <- names(youth_unemp_raw)[5:ncol(youth_unemp_raw)]

youth_unemp_long <- youth_unemp_raw %>%
  rename(
    Country_Name   = `Country Name`,
    Country_Code   = `Country Code`,
    Indicator_Name = `Indicator Name`,
    Indicator_Code = `Indicator Code`
  ) %>%
  pivot_longer(
    cols      = all_of(year_cols),
    names_to  = "Year",
    values_to = "youth_unemployment"
  ) %>%
  mutate(
    Year               = as.integer(Year),
    youth_unemployment = as.numeric(youth_unemployment)
  ) %>%
  filter(
    Year >= 1990,
    Year <= 2020,
    !is.na(youth_unemployment)
  )

youth_unemp_continent <- youth_unemp_long %>%
  inner_join(
    continents,
    by = c("Country_Code" = "Code", "Country_Name" = "Entity")
  )
```

------------------------------------------------------------------------

Clean population data

```{r clean-population}
population <- population_raw %>%
  rename(
    Country_Name = `Country Name`,
    Country_Code = `Country Code`,
    population   = Value
  ) %>%
  mutate(
    Year       = as.integer(Year),
    population = as.numeric(population)
  ) %>%
  filter(
    Year >= 1990,
    Year <= 2020,
    !is.na(population)
  )
```

------------------------------------------------------------------------

Combine NEET + population, compute weighted averages

```{r neet-pop-merge}
neet_pop <- neet_continent %>%
  inner_join(
    population,
    by = c("Code" = "Country_Code", "Year" = "Year")
  )

neet_continent_year <- neet_pop %>%
  group_by(Continent, Year) %>%
  summarise(
    total_pop      = sum(population),
    total_neet_pop = sum(neet_share/100 * population),
    .groups        = "drop"
  ) %>%
  mutate(
    neet_avg = (total_neet_pop / total_pop) * 100
  )
```

------------------------------------------------------------------------

Graph 1 - NEET trend (population-weighted)\*\*

```{r graph-neet-trend}
ggplot(neet_continent_year,
       aes(x = Year, y = neet_avg, colour = Continent)) +
  geom_line(linewidth = 0.9) +
  theme_economist_white() +
  scale_color_manual(values = continent_colors) +
  ggtitle("Are continents reducing NEET by 2020?") +
  xlab("Year") +
  ylab("Average NEET (%)")
```

------------------------------------------------------------------------

NEET values for 2000, 2015, 2020

```{r extract-neet-years}
neet_2000 <- neet_continent_year %>% filter(Year == 2000) %>% select(Continent, neet_2000 = neet_avg)
neet_2015 <- neet_continent_year %>% filter(Year == 2015) %>% select(Continent, neet_2015 = neet_avg)
neet_2020 <- neet_continent_year %>% filter(Year == 2020) %>% select(Continent, neet_2020 = neet_avg)
```

------------------------------------------------------------------------

Graph 2 - NEET change 2000 → 2020\*\*

```{r graph-neet-change-2000}
neet_change_2000 <- neet_2000 %>%
  inner_join(neet_2020, by = "Continent") %>%
  mutate(change_pp = neet_2020 - neet_2000)

ggplot(neet_change_2000,
       aes(x = reorder(Continent, change_pp), y = change_pp, fill = Continent)) +
  geom_col() + coord_flip() +
  theme_economist_white() +
  scale_fill_manual(values = continent_colors) +
  ggtitle("Change in NEET from 2000 to 2020") +
  xlab("Continent") + ylab("Change in NEET (percentage points)") +
  geom_hline(yintercept = 0, linetype = "dashed")
```

------------------------------------------------------------------------

Graph 3 - NEET change 2015 → 2020\*\*

```{r graph-neet-change-2015}
neet_change_2015 <- neet_2015 %>%
  inner_join(neet_2020, by = "Continent") %>%
  mutate(change_pp = neet_2020 - neet_2015)

ggplot(neet_change_2015,
       aes(x = reorder(Continent, change_pp), y = change_pp, fill = Continent)) +
  geom_col() + coord_flip() +
  theme_economist_white() +
  scale_fill_manual(values = continent_colors) +
  ggtitle("Change in NEET from 2015 to 2020") +
  xlab("Continent") + ylab("Change in NEET (percentage points)") +
  geom_hline(yintercept = 0, linetype = "dashed")
```

------------------------------------------------------------------------

Combine unemployment + population, compute weighted averages

```{r unemp-pop-merge}
unemp_pop <- youth_unemp_continent %>%
  inner_join(population, by = c("Country_Code", "Year"))

unemp_continent_year <- unemp_pop %>%
  group_by(Continent, Year) %>%
  summarise(
    total_pop       = sum(population),
    total_unemp_pop = sum(youth_unemployment/100 * population),
    .groups         = "drop"
  ) %>%
  mutate(
    unemp_avg = (total_unemp_pop / total_pop) * 100
  )
```

------------------------------------------------------------------------

Graph 4 - Youth unemployment trend (weighted)

```{r graph-unemp-trend}
ggplot(unemp_continent_year,
       aes(x = Year, y = unemp_avg, colour = Continent)) +
  geom_line(linewidth = 0.9) +
  theme_economist_white() +
  scale_color_manual(values = continent_colors) +
  ggtitle("Youth unemployment by continent ") +
  xlab("Year") +
  ylab("Youth unemployment (%)")
```

------------------------------------------------------------------------

Youth unemployment values for 2000, 2015, 2020

```{r extract-unemp-years}
unemp_2000 <- unemp_continent_year %>% filter(Year == 2000) %>% select(Continent, unemp_2000 = unemp_avg)
unemp_2015 <- unemp_continent_year %>% filter(Year == 2015) %>% select(Continent, unemp_2015 = unemp_avg)
unemp_2020 <- unemp_continent_year %>% filter(Year == 2020) %>% select(Continent, unemp_2020 = unemp_avg)
```

------------------------------------------------------------------------

Graph 5: Change in youth unemployment 2000 → 2020

```{r graph-unemp-change-2000}
unemp_change_2000 <- unemp_2000 %>%
  inner_join(unemp_2020, by = "Continent") %>%
  mutate(change_pp = unemp_2020 - unemp_2000)

ggplot(unemp_change_2000,
       aes(x = reorder(Continent, change_pp), y = change_pp, fill = Continent)) +
  geom_col() + coord_flip() +
  theme_economist_white() +
  scale_fill_manual(values = continent_colors) +
  ggtitle("Change in youth unemployment\nfrom 2000 to 2020") +
  xlab("Continent") + ylab("Change in youth unemployment (percentage points)") +
  geom_hline(yintercept = 0, linetype = "dashed")
```

------------------------------------------------------------------------

Graph 6: Change in youth unemployment 2015 → 2020

```{r graph-unemp-change-2015}
unemp_change_2015 <- unemp_2015 %>%
  inner_join(unemp_2020, by = "Continent") %>%
  mutate(change_pp = unemp_2020 - unemp_2015)

ggplot(unemp_change_2015,
       aes(x = reorder(Continent, change_pp), y = change_pp, fill = Continent)) +
  geom_col() + coord_flip() +
  theme_economist_white() +
  scale_fill_manual(values = continent_colors) +
  ggtitle("Change in youth unemployment\nfrom 2015 to 2020") +
  xlab("Continent") + ylab("Change in youth unemployment (percentage points)") +
  geom_hline(yintercept = 0, linetype = "dashed")
```

